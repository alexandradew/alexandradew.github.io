<!DOCTYPE html>
<html>
<head>
	<title>Ship Game</title>
	<style>
		body{
			background: #2c3e50;
			color:#FFF;
		}
		canvas{
			border:2px solid;
			background: #34495e;
		}

		#info{
			font-size:20px;
		}
			#meteor{
			font-size:20px;
		}
	</style>
</head>
<body>
<canvas width="600" height="800"></canvas>
<div id="info"></div>
<div id="meteor"></div>

<script>
	// variaveis do jogo
	var vidas = 3;
	var pontos = 0
	var fireSPEED = 10
	var speed = 5
	var shipLEFT = false, shipRIGHT = false
	var fireUP = false
	var LEFT = 37, RIGHT = 39
	var background = new Image();
	background.src = "bg.jpg";
	var cnv = document.querySelector('canvas');
	var ctx = cnv.getContext('2d');

	var ship = {
		x:270,
		y:700,
		w:50,
		h:50,
	}

	bullets = [];
	meteors=[
	{
		x:Math.floor(Math.random() * 520) + 1,
		y:-40,
		w:30,
		h:30
	},
	{
		x:Math.floor(Math.random() * 520) + 1,
		y:-40,
		w:30,
		h:30
	},
	{
		x:Math.floor(Math.random() * 520) + 1,
		y:-40,
		w:30,
		h:30
	}
	];

		

	update();


	// recebendo entradas do teclado

	window.addEventListener("keydown", function keydownHandler(e){
		var key =	e.keyCode;
		if (key === LEFT && key !== RIGHT){
			shipLEFT = true;
			shipRIGHT = false;
		}

		if (key === RIGHT && key !== LEFT){
			shipRIGHT = true;
			shipLEFT = false;
		}

		if (key === 65){
			bullets.push({
				x:ship.x+25,
				y:ship.y,
				w:5,
				h:5
			})
			fireUP = true
		}

	
	});

		window.addEventListener("keyup", function keyupHandler(e){
		var key =	e.keyCode;
		if (key === LEFT && key !== RIGHT){
			shipLEFT = false;
		}

		if (key === RIGHT && key !== LEFT){
			shipRIGHT = false;
		}

	});

// movimentação

	function move(){
		if(shipLEFT){
			ship.x-=speed;
		}

		if(shipRIGHT){
			ship.x+=speed;
		}

		if(ship.x > 550){
			ship.x = 550;
		}
		if(ship.x < 0){
			ship.x = 0;
		}

		if (fireUP){
		bullets.forEach( function(value,i,array){
			bullets[i].y-=4;
		})

		}
	}

	function colision(){
		bullets.forEach( function(value,i,array){
			meteors.forEach( function(value,m,array){
				if(bullets[i].y >= meteors[m].y && bullets[i].y <= meteors[m].y+meteors[m].h && bullets[i].x >= meteors[m].x && bullets[i].x <= meteors[m].x+meteors[m].w){
					meteors[m].x = Math.floor(Math.random() * 520) + 1;
					meteors[m].y = -30;
					delete bullets[i];
					pontos+=1
			}
			})
		})

		if (pontos > 10 && pontos < 11){
			phaseOne = true;
		}
	}

	// renderização de objetos

	render();

	function render(){
		ctx.clearRect(0,0,cnv.width,cnv.height);
		ctx.drawImage(background,0,0);
		ctx.fillStyle = "rgb(236, 240, 241)";
		ctx.fillRect(ship.x, ship.y, ship.w,ship.h);

		meteors.forEach( function(value,i,array){
			ctx.fillRect(meteors[i].x, meteors[i].y, meteors[i].w,meteors[i].h);
			meteors[i].y+=2;

			if (meteors[i].y > 800 ){
				meteors[i].x = Math.floor(Math.random() * 520) + 1;
				meteors[i].y = -30;
				vidas-=1;
			}
		})


		bullets.forEach( function(value,i,array){
			ctx.fillRect(bullets[i].x, bullets[i].y, bullets[i].w,bullets[i].h);
		})

		console.log(bullets)
	}

	function clearBullets(){
		bullets.forEach( function(value,i,array){
			if (bullets[i].y < 0){
				delete bullets[i];
			}
		})
	}

	function checkStatus(){
		if (vidas == 0){
			alert('game over');
			window.location.reload();
		}
	}

	// função recursiva que 'roda ' o jogo

	function update(){ 
		requestAnimationFrame(update, cnv);
		move();
		checkStatus();
		colision();
		clearBullets();
		render();
		document.getElementById('info').innerHTML = 
		'pontos ' + pontos +
		' Vidas ' + vidas +
		'<br>ship x: ' + ship.x +
		'<br>ship y: ' + ship.y;
		}

	</script>
</body>
</html>